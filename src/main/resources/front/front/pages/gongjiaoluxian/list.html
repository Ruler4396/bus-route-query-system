<!DOCTYPE html>
<html>
<head lang="en">
<meta charset="utf-8">
<title>公交路线</title>
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="../../layui/css/layui.css">
<link rel="stylesheet" href="../../xznstatic/css/common.css"/>
<link rel="stylesheet" href="../../xznstatic/css/style.css"/>
<link rel="stylesheet" href="../../css/accessibility-sr-only.css">
<link rel="stylesheet" href="../../css/accessibility-high-contrast.css">
<link rel="stylesheet" href="../../css/transit-business-ui.css">
<script type="text/javascript" src="../../xznstatic/js/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="../../xznstatic/js/jquery.SuperSlide.2.1.1.js"></script>
</head>
<style>
	html::after {
		position: fixed;
		top: 0;
		right: 0;
		left: 0;
		bottom: 0;
		content: '';
		display: block;
		background-attachment: fixed;
		background-size: cover;
		background-position: center;
	}
	#test1 {
		overflow: hidden;
	}
	#test1 .layui-carousel-ind li {
		width: 28px;
		height: 14px;
		border-width: 0;
		border-style: solid;
		border-color: rgba(0,0,0,.3);
		border-radius: 7px;
		background-color: rgba(191, 191, 191, 1);
		box-shadow: 0 0 0px rgba(255,0,0,.8);
	}
	#test1 .layui-carousel-ind li.layui-this {
		width: 60px;
		height: 14px;
		border-width: 0;
		border-style: solid;
		border-color: rgba(0,0,0,.3);
		border-radius: 7px;
		background-color: rgba(77, 79, 54, 1);
		box-shadow: 0 0 0px rgba(255,0,0,.8);
	}

	// 列表
	.recommend {
		padding: 10px 0;
		display: flex;
		justify-content: center;
		background-repeat: no-repeat;
		background-position: center center;
		background-size: cover;
	}
	.recommend .box {
	    width: 1002px;
		margin: 0 auto;
	}
	.recommend .box .title {
		padding: 10px 5px;
		display: flex;
		justify-content: space-between;
		align-items: center;
		box-sizing: border-box;
	}
	.recommend .box .title span {
		padding: 0 10px;
		font-size: 16px;
		line-height: 1.4;
	}

	.recommend .box .filter {
		padding: 0 10px;
		display: flex;
		align-items: center;
		box-sizing: border-box;
		width: 100%;
		flex-wrap: wrap;
	}
	.recommend .box .filter .item-list {
		display: flex;
		align-items: center;
	}
	.recommend .box .filter .item-list .lable {
		font-size: 14px;
		color: #333;
		box-sizing: border-box;
	}
	.recommend .box .filter .item-list input {
		padding: 0 10px;
		box-sizing: border-box;
		outline: none;
	}
	.recommend .box .filter button {
		display: flex;
		padding: 0 10px;
		box-sizing: border-box;
		align-items: center;
		justify-content: center;
		outline: none;
	}
	.recommend .box .filter button i {
		margin-right: 4px;
	}

	.recommend .box .list {
		display: flex;
		flex-wrap: wrap;
	}

	.recommend .box .list .list-item {
		flex: 0 0 33%;
		padding: 0 5px;
		box-sizing: border-box;
	}
	.recommend .box .list .list-item .list-item-body {
		cursor: pointer;
		border: 1px solid rgba(0, 0, 0, 3);
		padding: 5px;
		box-sizing: border-box;
	}
	.recommend .box .list .list-item-body img {
		width: 100%;
		height: 100px;
		display: block;
		margin: 0 auto;
	}

	.recommend .box .list .list-item-body .info {
		display: flex;
		flex-wrap: wrap;
	}
	.recommend .box .list .list-item-body .info .price {
		padding-top: 5px;
		color: red;
		font-size: 14px;
		text-align: center;
		box-sizing: border-box;
	}

	.recommend .box .list .list-item-body .info .name {
		padding-top: 5px;
		color: red;
		font-size: 14px;
		text-align: center;
		box-sizing: border-box;
	}

	.recommend .box .list .list-item3 {
		flex: 0 0 33.33%;
	}

	.recommend .box .list .list-item5 {
		flex: 0 0 20%;
	}

	.recommend .box .news {
		display: flex;
		flex-wrap: wrap;
		padding: 0;
width: 100%;
	}

	.recommend .box .news .list-item {
		flex: 0 0 25%;
		padding: 0 10px;
		box-sizing: border-box;
	}
	.recommend .box .news .list-item .list-item-body {
		cursor: pointer;
		border: 1px solid rgba(0, 0, 0, 3);
		padding: 10px;
		box-sizing: border-box;
		display: flex;
	}

	.recommend .box .news .list-item .list-item-body img {
		width: 120px;
		height: 100%;
		display: block;
		margin: 0 auto;
	}

	.recommend .box .news .list-item .list-item-body .item-info {
		flex: 1;
		display: flex;
		justify-content: space-between;
		flex-direction: column;
		padding-left: 10px;
		box-sizing: border-box;
	}

	.recommend .box .news .list-item .list-item-body .item-info .name {
		padding-top: 5px;
		color: red;
		font-size: 14px;
		box-sizing: border-box;
		overflow: hidden;
		text-overflow: ellipsis;
		display: -webkit-box;
		-webkit-line-clamp: 1;
		-webkit-box-orient: vertical;
	}

	.recommend .box .news .list-item .list-item-body .item-info .time {
		padding-top: 5px;
		color: red;
		font-size: 14px;
		overflow: hidden;
		text-overflow: ellipsis;
		display: -webkit-box;
		-webkit-line-clamp: 1;
		-webkit-box-orient: vertical;
		box-sizing: border-box;
	}

	.recommend .box .news .list-item1 {
		flex: 0 0 100%;
	}

	.recommend .box .news .list-item3 {
		flex: 0 0 33.33%;
	}

	.index-pv1 .animation-box:hover {
		transform: perspective(1000px) translate3d(0px, 0px, 0px) scale(1.03) rotate(15deg) skew(0deg, 0deg);
		transition: all 0.3s;
	}
	
	.index-pv1 .animation-box img:hover {
		transform: perspective(1000px) translate3d(0px, 0px, 0px) scale(1) rotate(0deg) skew(0deg, 0deg);
		transition: all 0.3s;
	}
  
  .layui-laypage .layui-laypage-count {
    padding: 0 10px;
  }
  .layui-laypage .layui-laypage-skip {
    padding-left: 10px;
  }
</style>
<body class="transit-ui transit-page page-route-list">
  <a href="#app" class="skip-link">跳转到主要内容</a>
  <div id="app" role="main" aria-label="公交路线查询" tabindex="-1">
    <div class="banner">
      <div class="layui-carousel" id="test1" :style='{"boxShadow":"0 0 0px rgba(255,0,0,.8)","margin":"0 auto","borderColor":"rgba(0,0,0,.3)","borderRadius":"0","borderWidth":"0","width":"100%","borderStyle":"solid"}'>
      		  <div carousel-item>
      			<div v-for="(item,index) in swiperList" :key="index">
      				<img style="width: 100%;height: 100%;object-fit:cover;" :src="item.img" />
      			</div>
      		  </div>
      		</div>
    </div>
	<div class="recommend index-pv1" :style='{"padding":"10px","boxShadow":"0 0 0px rgba(255,0,0,.8)","margin":"0","borderColor":"rgba(0,0,0,.3)","borderRadius":"0","borderWidth":"0","background":"#fff","borderStyle":"solid"}'>
		<div class="box" style='width:1200px'>
	    <div class="title" :style='{"padding":"10px","boxShadow":"0 0 0px rgba(255,0,0,.8)","margin":"10px 0 10px 0","borderColor":"rgba(0,0,0,.3)","backgroundColor":"rgba(46, 58, 31, 1)","borderRadius":"4px","borderWidth":"0","borderStyle":"solid","justifyContent":"space-between","height":"54px"}'>
	      <span :style='{"padding":"0 10px","boxShadow":"0 0 6px rgba(255,0,0,0)","borderColor":"rgba(255,0,0,1)","backgroundColor":"rgba(0,0,0,0)","color":"rgba(255, 255, 255, 1)","borderRadius":"0 0 2px 0","borderWidth":"0","fontSize":"18px","borderStyle":"solid"}'>公交路线</span><span :style='{"padding":"0 10px","boxShadow":"0 0 6px rgba(255,0,0,0)","borderColor":"rgba(0,0,0,0)","backgroundColor":"rgba(0,0,0,0)","color":"rgba(225, 225, 225, 1)","borderRadius":"0","borderWidth":"0","fontSize":"14px","borderStyle":"solid"}'>您现在的位置：公交路线</span>
	    </div>
		<section class="route-assist-panel" aria-label="无障碍路线检索指引">
			<h2>无障碍路线助手</h2>
			<p>最少只需输入起点和终点即可推荐。系统会把关键反馈同步成可见文本，便于听障用户快速确认当前状态。</p>
			<div class="route-assist-grid">
				<div class="assist-chip">大按钮：减少精细点击压力</div>
				<div class="assist-chip">高对比与大字号：提升低视力可读性</div>
				<div class="assist-chip">键盘可操作：支持 Enter / Space 打开路线</div>
			</div>
			<div id="routeLiveStatus" class="route-live-status" role="status" aria-live="polite">{{a11yStatusText}}</div>
		</section>
		<form class="layui-form filter" :style='{"padding":"0 10px","boxShadow":"0 0 0px rgba(255,0,0,.8)","margin":"10px 0 10px 0","borderColor":"rgba(0,0,0,.3)","backgroundColor":"rgba(0, 0, 0, 0)","borderRadius":"4px","borderWidth":"0","borderStyle":"solid","justifyContent":"flex-end","height":"64px"}'>
			<div class="item-list">
				<div class="lable" :style='{"padding":"0 10px","boxShadow":"0 0 6px rgba(255,0,0,0)","margin":"0","borderColor":"rgba(0,0,0,0)","backgroundColor":"transparent","color":"rgba(19, 19, 19, 1)","borderRadius":"0","textAlign":"right","borderWidth":"0","width":"auto","fontSize":"16px","borderStyle":"solid"}'>路线名称</div>
				<input type="text" :style='{"boxShadow":"0 0 6px rgba(255,0,0,0)","borderColor":"rgba(77, 79, 54, 1)","backgroundColor":"#fff","color":"#333","borderRadius":"8px","textAlign":"center","borderWidth":"3px","width":"140px","fontSize":"14px","borderStyle":"solid","height":"40px"}' name="luxianmingcheng" id="luxianmingcheng" placeholder="路线名称" autocomplete="off" class="layui-input">
			</div>
			<div class="item-list">
				<div class="lable" :style='{"padding":"0 10px","boxShadow":"0 0 6px rgba(255,0,0,0)","margin":"0","borderColor":"rgba(0,0,0,0)","backgroundColor":"transparent","color":"rgba(19, 19, 19, 1)","borderRadius":"0","textAlign":"right","borderWidth":"0","width":"auto","fontSize":"16px","borderStyle":"solid"}'>起点站名</div>
				<input type="text" :style='{"boxShadow":"0 0 6px rgba(255,0,0,0)","borderColor":"rgba(77, 79, 54, 1)","backgroundColor":"#fff","color":"#333","borderRadius":"8px","textAlign":"center","borderWidth":"3px","width":"140px","fontSize":"14px","borderStyle":"solid","height":"40px"}' name="qidianzhanming" id="qidianzhanming" placeholder="起点站名" autocomplete="off" class="layui-input">
			</div>
			<div class="item-list">
				<div class="lable" :style='{"padding":"0 10px","boxShadow":"0 0 6px rgba(255,0,0,0)","margin":"0","borderColor":"rgba(0,0,0,0)","backgroundColor":"transparent","color":"rgba(19, 19, 19, 1)","borderRadius":"0","textAlign":"right","borderWidth":"0","width":"auto","fontSize":"16px","borderStyle":"solid"}'>途径站点</div>
				<input type="text" :style='{"boxShadow":"0 0 6px rgba(255,0,0,0)","borderColor":"rgba(77, 79, 54, 1)","backgroundColor":"#fff","color":"#333","borderRadius":"8px","textAlign":"center","borderWidth":"3px","width":"140px","fontSize":"14px","borderStyle":"solid","height":"40px"}' name="tujingzhandian" id="tujingzhandian" placeholder="途径站点" autocomplete="off" class="layui-input">
			</div>
				<div class="item-list">
					<div class="lable" :style='{"padding":"0 10px","boxShadow":"0 0 6px rgba(255,0,0,0)","margin":"0","borderColor":"rgba(0,0,0,0)","backgroundColor":"transparent","color":"rgba(19, 19, 19, 1)","borderRadius":"0","textAlign":"right","borderWidth":"0","width":"auto","fontSize":"16px","borderStyle":"solid"}'>终点站名</div>
					<input type="text" :style='{"boxShadow":"0 0 6px rgba(255,0,0,0)","borderColor":"rgba(77, 79, 54, 1)","backgroundColor":"#fff","color":"#333","borderRadius":"8px","textAlign":"center","borderWidth":"3px","width":"140px","fontSize":"14px","borderStyle":"solid","height":"40px"}' name="zhongdianzhanming" id="zhongdianzhanming" placeholder="终点站名" autocomplete="off" class="layui-input">
				</div>
				<div class="item-list">
					<div class="lable" :style='{"padding":"0 10px","boxShadow":"0 0 6px rgba(255,0,0,0)","margin":"0","borderColor":"rgba(0,0,0,0)","backgroundColor":"transparent","color":"rgba(19, 19, 19, 1)","borderRadius":"0","textAlign":"right","borderWidth":"0","width":"auto","fontSize":"16px","borderStyle":"solid"}'>推荐偏好</div>
					<select id="preferenceType" :style='{"boxShadow":"0 0 6px rgba(255,0,0,0)","borderColor":"rgba(77, 79, 54, 1)","backgroundColor":"#fff","color":"#333","borderRadius":"8px","textAlign":"center","borderWidth":"3px","width":"140px","fontSize":"14px","borderStyle":"solid","height":"40px"}' class="layui-input">
						<option value="AUTO" selected>智能推荐</option>
						<option value="ACCESSIBLE">无障碍优先</option>
						<option value="TIME">时间优先</option>
						<option value="DISTANCE">距离优先</option>
					</select>
				</div>
				<button :style='{"padding":"0 15px","boxShadow":"0 0 0px rgba(0,0,0,0)","margin":"0 0 0 10px","borderColor":"#409EFF","backgroundColor":"rgba(77, 79, 54, 1)","color":"#fff","borderRadius":"4px","borderWidth":"0","width":"auto","fontSize":"14px","borderStyle":"solid","height":"40px"}' id="btn-search" type="button" class="layui-btn layui-btn-normal">
				  <i v-if="true" class="layui-icon layui-icon-search"></i>搜索
				</button>
				<button :style='{"padding":"0 15px","boxShadow":"0 0 0px rgba(0,0,0,0)","margin":"0 0 0 10px","borderColor":"#409EFF","backgroundColor":"rgba(183, 186, 107, 1)","color":"#fff","borderRadius":"4px","borderWidth":"0","width":"auto","fontSize":"14px","borderStyle":"solid","height":"40px"}' id="btn-plan" type="button" class="layui-btn layui-btn-normal">
				  <i v-if="true" class="layui-icon layui-icon-release"></i>无障碍推荐
				</button>
				<button :style='{"padding":"0 15px","boxShadow":"0 0 0px rgba(0,0,0,0)","margin":"0 0 0 10px","borderColor":"#409EFF","backgroundColor":"rgba(183, 186, 107, 1)","color":"#fff","borderRadius":"4px","borderWidth":"0","width":"auto","fontSize":"14px","borderStyle":"solid","height":"40px"}' @click="jump('../gongjiaoluxian/map.html')" type="button" class="layui-btn btn-theme">
				  <i v-if="true" class="layui-icon">&#xe635;</i>地图
				</button>
			<button :style='{"padding":"0 15px","boxShadow":"0 0 0px rgba(0,0,0,0)","margin":"0 0 0 10px","borderColor":"#409EFF","backgroundColor":"rgba(77, 79, 54, 1)","color":"#fff","borderRadius":"4px","borderWidth":"0","width":"auto","fontSize":"14px","borderStyle":"solid","height":"40px"}' v-if="isAuth('gongjiaoluxian','新增')" @click="jump('../gongjiaoluxian/add.html')" type="button" class="layui-btn btn-theme">
			  <i v-if="true" class="layui-icon">&#xe654;</i>添加
			</button>
			</form>
			<div v-if="isPlanMode" :style='{"padding":"0 10px","margin":"0 0 10px 0","color":"rgba(77, 79, 54, 1)","fontSize":"14px","fontWeight":"600"}'>
				当前展示：无障碍推荐结果（按综合评分降序）
			</div>
			<div v-if="planNoticeText" class="route-plan-notice" role="status" aria-live="polite" :style='{"padding":"8px 12px","margin":"0 10px 12px 10px","borderRadius":"6px","fontSize":"13px","lineHeight":"1.5","border":"1px solid","borderColor":planNoticeType==="error"?"#d9534f":(planNoticeType==="warn"?"#f0ad4e":(planNoticeType==="success"?"#5cb85c":"#999")),"backgroundColor":planNoticeType==="error"?"#fbe9e7":(planNoticeType==="warn"?"#fff7e6":(planNoticeType==="success"?"#edf7ed":"#f7f7f7")),"color":planNoticeType==="error"?"#a94442":(planNoticeType==="warn"?"#8a6d3b":(planNoticeType==="success"?"#3c763d":"#555"))}'>
				{{planNoticeText}}
			</div>
		    <!-- 样式一 -->
		    <div class="list" style="position: relative;">
		      <div
			  	v-for="(item,index) in dataList"
				:key="index"
				class="list-item"
				:class="3=='3'?'list-item3':3=='5'?'list-item5':''"
				role="button"
				tabindex="0"
				:aria-label="'查看路线详情：' + item.luxianmingcheng"
				@click="openRouteDetail(item)"
				@keydown="onRouteCardKeydown($event, item)"
			  >
		        <div class="list-item-body animation-box" :style='{"padding":"10px","boxShadow":"0px 0px 0px 10px rgba(183, 186, 107, 1)","margin":"0 50px 50px 70px","borderColor":"rgba(183, 186, 107, 1)","backgroundColor":"#fff","borderRadius":"50%","borderWidth":"0","borderStyle":"solid"}'>
				<img :style='{"boxShadow":"0 0 0px rgba(77, 79, 54,.8)","borderColor":"rgba(0,0,0,.3)","borderRadius":"50% ","borderWidth":"0","width":"180px","borderStyle":"solid","height":"180px"}' :src="item.fengmian?baseurl+item.fengmian.split(',')[0]:''" :alt="item.luxianmingcheng + '路线封面'">
				<div class="info">
					<div v-if="item.price" :style='{"padding":"5px","margin":"10px 0 0 0","backgroundColor":"rgba(0,0,0,0)","color":"rgba(183, 186, 107, 1)","borderRadius":"0","textAlign":"center","width":"100%","fontSize":"18px"}' class="price"><span :style='{"fontSize":"12px"}'>￥</span>{{Number(item.price).toFixed(2)}}</div>
						<div v-if="item.vipprice&&item.vipprice>0" :style='{"padding":"5px","margin":"10px 0 0 0","backgroundColor":"rgba(0,0,0,0)","color":"rgba(183, 186, 107, 1)","borderRadius":"0","textAlign":"center","width":"100%","fontSize":"18px"}' class="price"><span :style='{"fontSize":"12px"}'>￥</span>{{Number(item.vipprice).toFixed(2)}} <span :style='{"fontSize":"12px"}'>会员价</span></div>
						<div v-if="item.jf" :style='{"padding":"5px","margin":"10px 0 0 0","backgroundColor":"rgba(0,0,0,0)","color":"rgba(183, 186, 107, 1)","borderRadius":"0","textAlign":"center","width":"100%","fontSize":"18px"}' class="price"><span :style='{"fontSize":"12px"}'></span>{{Number(item.jf).toFixed(0)}}积分</div>
						<div v-if="true" :style='{"isshow":true,"padding":"5px","margin":"5px 0 0 0","backgroundColor":"rgba(0,0,0,0)","color":"rgba(0, 0, 0, 1)","borderRadius":"0","textAlign":"center","width":"100%","fontSize":"12px"}' class="name route-card-name">{{item.luxianmingcheng}}</div>
						<div class="route-card-meta">
							<div>起点：{{item.qidianzhanming || '暂无'}}</div>
							<div>终点：{{item.zhongdianzhanming || '暂无'}}</div>
						</div>
						<div class="route-card-meta">
							<div>途经：{{item.tujingzhandian || '暂无'}}</div>
							<div>点击：{{item.clicknum || 0}}</div>
						</div>
						<div v-if="item.isRecommended" :style='{"padding":"4px 8px","margin":"4px 0 0 0","backgroundColor":"rgba(46, 58, 31, 1)","color":"#fff","borderRadius":"12px","textAlign":"center","width":"100%","fontSize":"12px"}'>
							推荐分 {{Number(item.totalScore || 0).toFixed(1)}} / 无障碍 {{Number(item.accessibilityScore || 0).toFixed(1)}}
						</div>
						<div class="route-card-tags">
							<span class="route-tag" :class="item.wuzhangaijibie <= 1 ? 'good' : 'warn'">无障碍等级：{{item.accessibilityLevelText || getAccessibilityLevelText(item.wuzhangaijibie)}}</span>
							<span class="route-tag" :class="item.mangdaozhichi==1 ? 'good' : 'warn'">{{item.blindPathSupportText || ('盲道支持：' + (item.mangdaozhichi==1 ? '有' : '未知/无'))}}</span>
							<span class="route-tag" :class="item.yuyintongbao==1 ? 'good' : 'warn'">{{item.voiceAnnounceText || ('语音提示：' + (item.yuyintongbao==1 ? '支持' : '未知/无'))}}</span>
							<span v-if="item.guideDogSupportText || item.ditezhichi!=null" class="route-tag" :class="item.ditezhichi==1 ? 'good' : 'warn'">{{item.guideDogSupportText || ('导盲犬支持：' + (item.ditezhichi==1 ? '支持' : '未知/无'))}}</span>
						</div>
						<div v-if="item.recommendationReason" :style='{"padding":"4px 6px","margin":"4px 0 0 0","backgroundColor":"rgba(245, 247, 238, 1)","color":"rgba(46, 58, 31, 1)","borderRadius":"6px","textAlign":"center","width":"100%","fontSize":"12px"}'>
							{{item.recommendationReason}}
						</div>
					</div>
		        </div>
		      </div>
			  <div v-if="!dataList || dataList.length===0" :style='{"padding":"30px 0","textAlign":"center","color":"rgba(90, 90, 90, 1)","fontSize":"14px"}'>
				  {{isPlanMode ? "暂无可用推荐路线，请调整起终点或偏好后重试" : "暂无线路数据"}}
			  </div>
		    </div>
		<div class="pager" id="pager" :style="{textAlign:2==1?'left':2==2?'center':'right'}"></div>
	  </div>
	</div>


  </div>

  <script src="../../layui/layui.js"></script>
  <script src="../../js/vue.js"></script>
	  <script src="../../js/config.js"></script>
	  <script src="../../modules/config.js"></script>
	  <script src="../../js/utils.js"></script>
	  <script src="../../js/accessibility.js"></script>

  <script type="text/javascript">
    var vue = new Vue({
      el: '#app',
	      data: {
	        swiperList: [],
	        dataList: [],
	baseurl:'',
	swiperIndex: '-1',
	isPlanMode: false,
	planNoticeType: '',
	planNoticeText: '',
	a11yStatusText: '请输入起点与终点站名，点击“无障碍推荐”开始。'
	      },
      filters: {
        newsDesc: function(val) {
          if (val) {
            if (val.length > 60) {
              return val.substring(0, 60).replace(/<[^>]*>/g).replace(/undefined/g, '');
            } else {
              return val.replace(/<[^>]*>/g).replace(/undefined/g, '');
            }
          }
          return '';
        }
      },
      methods: {
      	isAuth(tablename, button) {
          return isFrontAuth(tablename, button)
        },
        jump(url) {
          jump(url)
        },
		openRouteDetail(item) {
		  if (!item || !item.id) return;
		  jump(this.routeDetailUrl(item));
		},
		routeDetailUrl(item) {
		  return '../gongjiaoluxian/detail.html?id=' + item.id;
		},
		onRouteCardKeydown(event, item) {
		  if (!event) return;
		  if (event.key === 'Enter' || event.key === ' ') {
			event.preventDefault();
			this.openRouteDetail(item);
		  }
		},
		getAccessibilityLevelText(level) {
		  var map = ['完全无障碍', '较高无障碍', '部分无障碍', '障碍较多'];
		  var idx = Number(level);
		  if (isNaN(idx) || idx < 0 || idx >= map.length) {
			return '暂无';
		  }
		  return map[idx];
        }
      }
    });

    layui.use(['layer', 'element', 'carousel', 'laypage', 'http', 'jquery','laydate'], function() {
	var layer = layui.layer;
	var element = layui.element;
	var carousel = layui.carousel;
	var laypage = layui.laypage;
	var http = layui.http;
	var jquery = layui.jquery;
	var laydate = layui.laydate;

	var limit = 8;
    limit = 3 * 2;
	vue.baseurl = http.baseurl;
      // 获取轮播图 数据
      http.request('config/list', 'get', {
        page: 1,
        limit: 5
      }, function(res) {
        if (res.data.list.length > 0) {
          let swiperList = [];
          res.data.list.forEach(element => {
            if (element.value != null) {
              swiperList.push({
                img: http.baseurl+element.value
              });
            }
          });
          vue.swiperList = swiperList;

		  vue.$nextTick(() => {
		    carousel.render({
		    	elem: '#test1',
		  				width: '100%',
		    	height: '550px',
		    	arrow: 'hover',
		    	anim: 'default',
		    	autoplay: 'true',
		    	interval: '3000',
		    	indicator: 'inside'
		    });

		  })
          // vue.$nextTick(()=>{
          //   window.xznSlide();
          // });
        }
      });



      // 分页列表
      pageList();

	      // 搜索按钮
	      jquery('#btn-search').click(function(e) {
	        pageList();
	      });

	      // 无障碍推荐按钮
	      jquery('#btn-plan').click(function(e) {
	        planAccessibleRoutes();
	      });

	      function clearPager() {
	        jquery('#pager').html('');
	      }

	      function setPlanNotice(type, text) {
	        vue.planNoticeType = type || '';
	        vue.planNoticeText = text || '';
			vue.a11yStatusText = text || '可输入筛选条件后开始查询。';
			if (window.AccessibilityUtils && text) {
			  AccessibilityUtils.announce(text);
			}
	      }

	      function clearPlanNotice() {
	        setPlanNotice('', '');
	      }

	      function pageList() {
	        var param = {
	          page: 1,
	          limit: limit
	        }


        if (jquery('#luxianmingcheng').val()) {
          param['luxianmingcheng'] = jquery('#luxianmingcheng').val() ? '%' + jquery('#luxianmingcheng').val() + '%' : '';
        }
        if (jquery('#qidianzhanming').val()) {
          param['qidianzhanming'] = jquery('#qidianzhanming').val() ? '%' + jquery('#qidianzhanming').val() + '%' : '';
        }
        if (jquery('#tujingzhandian').val()) {
          param['tujingzhandian'] = jquery('#tujingzhandian').val() ? '%' + jquery('#tujingzhandian').val() + '%' : '';
        }
        if (jquery('#zhongdianzhanming').val()) {
          param['zhongdianzhanming'] = jquery('#zhongdianzhanming').val() ? '%' + jquery('#zhongdianzhanming').val() + '%' : '';
        }



	        // 获取列表数据
	        http.request('gongjiaoluxian/list', 'get', param, function(res) {
	          vue.isPlanMode = false;
	          clearPlanNotice();
	          vue.dataList = res.data.list
	          // 分页
	          laypage.render({
            elem: 'pager',
            count: res.data.total,
            limit: limit,
            groups: 5,
            layout: ["prev","page","next"],
            theme: '#B7BA6B',
            jump: function(obj, first) {
            	param.page = obj.curr;
              //首次不执行
              if (!first) {
                http.request('gongjiaoluxian/list', 'get', param, function(res) {
                  vue.dataList = res.data.list
                })
              }
            }
	          });
	        })
	      }

	      function planAccessibleRoutes() {
	        var startStation = jquery.trim(jquery('#qidianzhanming').val() || '');
	        var endStation = jquery.trim(jquery('#zhongdianzhanming').val() || '');

	        if (!startStation || !endStation) {
	          setPlanNotice('warn', '请先输入起点站名和终点站名，再执行无障碍推荐');
	          layer.msg('请先输入起点站名和终点站名');
	          return;
	        }

	        var param = {
	          startStation: startStation,
	          endStation: endStation,
	          preferenceType: jquery('#preferenceType').val() || 'AUTO'
	        };
	        var userId = localStorage.getItem('userid');
	        if (userId && userId !== 'null' && userId !== 'undefined') {
	          param.userId = userId;
	        }

	        setPlanNotice('info', '正在计算推荐路线，请稍候...');
	        var loadingIndex = layer.load(1, {
	          shade: [0.1, '#fff']
	        });

	        jquery.ajax({
	          url: http.baseurl + 'route/plan',
	          type: 'get',
	          data: param,
	          dataType: 'json',
	          beforeSend: function(request) {
	            request.setRequestHeader("Token", localStorage.getItem("Token"));
	          },
	          success: function(res) {
	            if (!res || res.code !== 0) {
	              vue.isPlanMode = true;
	              vue.dataList = [];
	              clearPager();
	              setPlanNotice('error', (res && res.msg) ? res.msg : '推荐服务返回异常，请稍后重试');
	              return;
	            }

	            var routeResults = (res.data && res.data.list && jquery.isArray(res.data.list)) ? res.data.list : [];
	            var list = [];
	            routeResults.forEach(function(result) {
	              if (!result || !result.route) {
	                return;
	              }
	              var route = result.route;
	              route.accessibilityScore = Number(result.accessibilityScore || 0);
	              route.totalScore = Number(result.totalScore || 0);
	              route.recommendationReason = result.recommendationReason || '暂无推荐理由';
	              route.accessibilityLevelText = result.accessibilityLevelText || '';
	              route.voiceAnnounceText = result.voiceAnnounceText || '';
	              route.blindPathSupportText = result.blindPathSupportText || '';
	              route.guideDogSupportText = result.guideDogSupportText || '';
	              route.isRecommended = true;
	              list.push(route);
	            });

	            vue.isPlanMode = true;
	            vue.dataList = list;
	            clearPager();

	            if (!list.length) {
	              setPlanNotice('warn', '未找到匹配路线，请调整起终点或偏好后重试');
	              layer.msg('未找到匹配路线，请调整起终点后重试');
	              return;
	            }

	            setPlanNotice('success', '已返回 ' + list.length + ' 条推荐路线');
	          },
	          error: function(xhr, status, error) {
	            vue.isPlanMode = true;
	            vue.dataList = [];
	            clearPager();
	            setPlanNotice('error', '推荐接口请求失败：' + (error || status || '未知错误'));
	            layer.msg('推荐接口请求失败，请检查后端服务');
	          },
	          complete: function() {
	            layer.close(loadingIndex);
	          }
	        });
	      }
	    });

    window.xznSlide = function() {
      jQuery(".banner").slide({mainCell:".bd ul",autoPlay:true,interTime:5000});
      jQuery("#ifocus").slide({ titCell:"#ifocus_btn li", mainCell:"#ifocus_piclist ul",effect:"leftLoop", delayTime:200, autoPlay:true,triggerTime:0});
      jQuery("#ifocus").slide({ titCell:"#ifocus_btn li", mainCell:"#ifocus_tx ul",delayTime:0, autoPlay:true});
      jQuery(".product_list").slide({mainCell:".bd ul",autoPage:true,effect:"leftLoop",autoPlay:true,vis:5,trigger:"click",interTime:4000});
    };
  </script>
</body>
</html>
